#include "mainwindow.h"
#include "ui_mainwindow.h"

#include <Qsci/qsciscintilla.h>
#include <Qsci/qscilexercustom.h>
#include <Qsci/qsciabstractapis.h>
#include <Qsci/qscistyle.h>

#include <textparser.h>
#include <../definitions/cfml_definition.json.h>


static const quint8 breakpoint_png[] =
    {
        0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A,0x00,0x00,0x00,0x0D,0x49,0x48,0x44
        ,0x52,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x08,0x06,0x00,0x00,0x00,0x1F
        ,0xF3,0xFF,0x61,0x00,0x00,0x00,0x01,0x73,0x52,0x47,0x42,0x00,0xAE,0xCE,0x1C
        ,0xE9,0x00,0x00,0x00,0x06,0x62,0x4B,0x47,0x44,0x00,0xFF,0x00,0xFF,0x00,0xFF
        ,0xA0,0xBD,0xA7,0x93,0x00,0x00,0x00,0x09,0x70,0x48,0x59,0x73,0x00,0x00,0x0D
        ,0xD7,0x00,0x00,0x0D,0xD7,0x01,0x42,0x28,0x9B,0x78,0x00,0x00,0x00,0x07,0x74
        ,0x49,0x4D,0x45,0x07,0xDA,0x03,0x05,0x0C,0x0A,0x3A,0x3A,0xF6,0xD7,0x57,0x00
        ,0x00,0x02,0x7D,0x49,0x44,0x41,0x54,0x38,0xCB,0xAD,0x93,0x4B,0x6B,0x14,0x51
        ,0x10,0x85,0xBF,0x7B,0xBB,0x27,0xF3,0x1E,0xC9,0x28,0x26,0xC1,0x5D,0x10,0x23
        ,0x88,0x42,0x20,0x18,0x89,0x20,0xE6,0x17,0x88,0x3B,0x83,0x3B,0x37,0x8A,0xAE
        ,0xFC,0x27,0x82,0x28,0x82,0x20,0xB8,0x12,0xC1,0xAD,0x0B,0x71,0x11,0x54,0x8C
        ,0x11,0xC1,0x07,0x8A,0x31,0x24,0x18,0x92,0x18,0x86,0x19,0x0D,0xB1,0xA7,0x9F
        ,0xD3,0xDD,0xF7,0x96,0x8B,0xD6,0x10,0xC1,0xA5,0x07,0x0E,0x05,0x17,0xEE,0xA1
        ,0xEA,0x9C,0x2A,0xC5,0x1E,0xCC,0x83,0x5B,0x83,0x8B,0xD5,0xC9,0xC9,0x2B,0xE5
        ,0xF1,0xF1,0xE3,0xA5,0x76,0xBB,0x9A,0x77,0xBB,0xC1,0x60,0x65,0x65,0x31,0x5A
        ,0x5A,0xBA,0x79,0x12,0x1E,0x2B,0x10,0xFE,0x85,0x37,0x30,0xF1,0x69,0x7A,0x7A
        ,0x73,0xFB,0xE1,0xC3,0x3C,0x5D,0x5F,0x97,0x6C,0x73,0xB3,0xE0,0xC6,0x86,0x0C
        ,0xD6,0xD6,0xA4,0x7B,0xE7,0x8E,0xF9,0x70,0xF4,0xE8,0xDB,0x97,0x70,0x70,0xEF
        ,0x3F,0x05,0xB0,0x00,0x87,0xEB,0x47,0x8E,0xBC,0x1B,0xBF,0x75,0xAB,0x3E,0xD4
        ,0x6C,0x2A,0xB4,0x06,0xA5,0x0A,0x8A,0x80,0x08,0x62,0x2D,0x49,0xA7,0x63,0xBF
        ,0x5E,0xBE,0xFC,0xCD,0xF6,0x7A,0x27,0xA6,0xC0,0x03,0x70,0x04,0x54,0x47,0xEB
        ,0xF9,0xB1,0xB9,0xB9,0x43,0xD5,0xB1,0x31,0x2D,0x71,0xCC,0x2E,0xA3,0x08,0x09
        ,0x43,0x24,0x08,0x90,0x7E,0x1F,0x6D,0x8C,0x32,0xBE,0x5F,0x8B,0x96,0x97,0x0F
        ,0xDF,0x15,0x79,0x04,0xE0,0x2E,0xC2,0xF9,0x21,0xD7,0x1D,0xAF,0x38,0x8E,0x36
        ,0xDD,0x2E,0xBA,0x5C,0x86,0x52,0x09,0x5C,0xB7,0xE8,0xC0,0x5A,0xC8,0x73,0x24
        ,0xCB,0x90,0xC1,0x80,0x66,0xA3,0x51,0xFA,0x2E,0x72,0x6E,0x01,0x8E,0xCF,0xC0
        ,0x47,0xD7,0x71,0x9C,0xAB,0x8D,0x91,0x91,0x46,0xBE,0xBA,0x8A,0xDE,0xB7,0x0F
        ,0x69,0x34,0x50,0x95,0x0A,0x38,0x0E,0x4A,0x6B,0xE4,0x8F,0x40,0x1C,0x63,0x7D
        ,0x1F,0xD9,0xDA,0xA2,0x3E,0x3C,0xAC,0xA3,0xED,0xED,0x4B,0xC0,0x75,0x17,0x6B
        ,0xA7,0xCA,0xAD,0x16,0x92,0xA6,0xE4,0x2B,0x2B,0xE8,0xD1,0x51,0x54,0xAB,0x85
        ,0xAE,0x54,0x10,0xC7,0x81,0x3C,0xC7,0x0E,0x06,0xC8,0xCE,0x0E,0x79,0xA7,0x83
        ,0x88,0x50,0x6E,0xB5,0x86,0xA2,0x9D,0x9D,0x33,0x58,0x8B,0x6B,0x45,0x1A,0x8E
        ,0xEB,0x82,0xD6,0x48,0x9E,0x63,0x7D,0x1F,0x6D,0x0C,0xB6,0x56,0x43,0x55,0xAB
        ,0x85,0x0F,0x51,0x84,0x0D,0x43,0x94,0xB5,0x88,0xD6,0x38,0xA5,0x12,0x02,0xC3
        ,0x00,0x5A,0x29,0xE5,0x99,0x34,0x2D,0x66,0xFD,0xCD,0xDD,0xB6,0xA3,0x08,0xC9
        ,0x73,0xC4,0x18,0x30,0xA6,0x78,0xB7,0x16,0x93,0xA6,0xA0,0x54,0x0F,0x40,0x03
        ,0xCF,0x13,0xCF,0x93,0x5D,0xA3,0x92,0x04,0xD2,0x14,0xFB,0x27,0x85,0x38,0x46
        ,0xD2,0x14,0x49,0x53,0xC8,0x32,0x24,0xCB,0x88,0x3D,0x2F,0x11,0x63,0x9E,0x00
        ,0x68,0x23,0x72,0xC3,0xEF,0xF5,0x62,0x1B,0xC7,0x48,0x92,0x14,0x66,0x05,0x01
        ,0x12,0x86,0xD8,0x30,0x2C,0x62,0x0C,0xC3,0x42,0x2C,0x49,0xC8,0x83,0x80,0xD8
        ,0xF3,0xC4,0xC0,0x3D,0x00,0x3D,0x03,0xCF,0x44,0xE4,0xC5,0x8F,0xE5,0xE5,0x44
        ,0xA2,0xA8,0xC8,0xDC,0xF7,0xB1,0xFD,0x3E,0xE2,0x79,0x45,0xF5,0xFD,0x42,0x30
        ,0x08,0xE8,0x2D,0x2D,0xC5,0x0A,0x6E,0x9F,0x86,0xF5,0xBD,0x9B,0xD8,0x76,0x94
        ,0x7A,0x5F,0x69,0x36,0x0F,0x1E,0x98,0x98,0x28,0xBB,0xF5,0x7A,0xB1,0x07,0x5A
        ,0x17,0x9E,0x64,0x19,0x59,0xBF,0x4F,0xEF,0xCB,0x97,0x24,0x4F,0x92,0xB7,0x0D
        ,0x91,0xD9,0x63,0x90,0xEE,0x0A,0x00,0xBC,0x86,0xFD,0x4A,0xA9,0x07,0xC0,0xD9
        ,0x5A,0xBB,0x2D,0xE5,0x56,0x6B,0xC8,0x29,0x95,0x30,0x69,0x4A,0xFC,0xF3,0xE7
        ,0x20,0xF2,0x3C,0x17,0xA5,0xEE,0xC7,0xD6,0x5E,0x9B,0x85,0xE4,0xAF,0x5B,0xD8
        ,0x8B,0x57,0x30,0xAD,0xE0,0x82,0xD6,0xFA,0x8C,0x85,0xB6,0x52,0xAA,0x2B,0xC6
        ,0x3C,0x05,0x1E,0x9C,0x82,0xCF,0xFC,0x6F,0xFC,0x02,0x62,0x4A,0x95,0x5A,0x65
        ,0x04,0x91,0x38,0x00,0x00,0x00,0x00,0x49,0x45,0x4E,0x44,0xAE,0x42,0x60,0x82
};

static const quint8 breakpoint_pending_png[] =
    {
        0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A,0x00,0x00,0x00,0x0D,0x49,0x48,0x44
        ,0x52,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x08,0x06,0x00,0x00,0x00,0x1F
        ,0xF3,0xFF,0x61,0x00,0x00,0x00,0x01,0x73,0x52,0x47,0x42,0x00,0xAE,0xCE,0x1C
        ,0xE9,0x00,0x00,0x00,0x06,0x62,0x4B,0x47,0x44,0x00,0xFF,0x00,0xFF,0x00,0xFF
        ,0xA0,0xBD,0xA7,0x93,0x00,0x00,0x00,0x09,0x70,0x48,0x59,0x73,0x00,0x00,0x0D
        ,0xD7,0x00,0x00,0x0D,0xD7,0x01,0x42,0x28,0x9B,0x78,0x00,0x00,0x00,0x07,0x74
        ,0x49,0x4D,0x45,0x07,0xDA,0x03,0x05,0x0C,0x0A,0x0F,0x6C,0x45,0x13,0x74,0x00
        ,0x00,0x02,0xE8,0x49,0x44,0x41,0x54,0x38,0xCB,0x8D,0x93,0xDF,0x6B,0x1C,0x75
        ,0x14,0xC5,0x3F,0xDF,0xEF,0xCC,0xEC,0xAF,0x6E,0xB7,0xB8,0x34,0x69,0x36,0x29
        ,0x82,0x6B,0xDA,0x46,0xC4,0xB4,0x4B,0x53,0x53,0x22,0x48,0xAA,0xD2,0x67,0x8B
        ,0x20,0x8D,0xFA,0x58,0x88,0xF8,0xE4,0x3F,0x20,0xF8,0x22,0x88,0x2F,0x0A,0x1A
        ,0x08,0xF8,0x20,0x42,0x31,0x54,0x8A,0x2F,0x52,0x0A,0x5A,0x28,0x2A,0x6A,0x6D
        ,0x8B,0x92,0xA0,0x29,0xEB,0xDA,0x9F,0x69,0x88,0x93,0x36,0xDD,0xEC,0xCC,0xCE
        ,0xCE,0xEC,0xEC,0xCC,0xF7,0xFA,0xB0,0xB4,0x09,0xE2,0x83,0x07,0x0E,0x17,0x2E
        ,0xF7,0xC0,0x3D,0xF7,0x70,0x15,0xDB,0x70,0x11,0xEC,0x02,0xBC,0x9E,0xAF,0xD5
        ,0xDE,0xCC,0x56,0xAB,0xCF,0x38,0xE5,0x72,0x3E,0x71,0xDD,0x76,0xB7,0xD1,0xB8
        ,0xD4,0xB9,0x76,0xED,0xE3,0x67,0xE1,0x9C,0x02,0xE1,0xBF,0x70,0x05,0x0E,0xFC
        ,0x3E,0x39,0xB9,0xB2,0x71,0xE6,0x4C,0x12,0xDF,0xBE,0x2D,0xBD,0x95,0x95,0x3E
        ,0xEF,0xDC,0x91,0xEE,0xCD,0x9B,0xE2,0xCE,0xCF,0xA7,0x8B,0x63,0x63,0xBF,0xFE
        ,0x08,0x83,0xDB,0x75,0x0A,0xE0,0x27,0x18,0xDD,0xB1,0x7F,0xFF,0x6F,0xD5,0xB9
        ,0xB9,0x1D,0x99,0x9D,0x3B,0x15,0x5A,0x83,0x52,0x7D,0x8A,0x80,0x08,0x62,0x0C
        ,0xD1,0xDA,0x9A,0xB9,0x31,0x3B,0x7B,0xD7,0xAC,0xAF,0x8F,0x4F,0x40,0x0B,0xC0
        ,0x12,0x50,0x6B,0x5A,0x5F,0xAC,0xCC,0xCC,0x8C,0xE4,0x2B,0x15,0x2D,0x61,0xC8
        ,0x23,0x76,0x3A,0x48,0x10,0x20,0xED,0x36,0xE2,0x79,0xE8,0x34,0x55,0xA9,0xEF
        ,0x17,0x3A,0xF5,0xFA,0xE8,0xA7,0x22,0x67,0x01,0xEC,0x4B,0x70,0x22,0x63,0xDB
        ,0xD5,0x9C,0x65,0xE9,0xD4,0x75,0xD1,0xD9,0x2C,0x38,0x0E,0xD8,0x76,0x7F,0x03
        ,0x63,0xD8,0xBC,0x97,0x67,0xD5,0x1D,0x46,0x29,0x43,0x5A,0x78,0xD5,0xD9,0x78
        ,0x6A,0xDF,0x2B,0x9F,0x0D,0x9C,0xFC,0xE0,0x86,0x3B,0xBE,0xA0,0x2E,0x5B,0xD6
        ,0x85,0x5D,0xC3,0xC3,0x2F,0x3E,0x76,0xF0,0x20,0x99,0xC3,0x87,0x51,0xC5,0x22
        ,0x2A,0x97,0x03,0xCB,0x42,0x69,0x8D,0x18,0xC3,0xC2,0xD9,0x13,0x3C,0x7E,0x7C
        ,0x08,0x27,0xBB,0xE5,0x3D,0x89,0xE1,0xF2,0x69,0x36,0x6C,0x8C,0x99,0xC8,0x96
        ,0x4A,0x48,0x1C,0x93,0x34,0x1A,0xE8,0xA1,0x21,0x54,0xA9,0x84,0xCE,0xE5,0x10
        ,0xCB,0x82,0x24,0x61,0x74,0x68,0x89,0x6F,0x3E,0xEF,0x62,0xA1,0xC9,0x5B,0x16
        ,0xDD,0x5E,0x8F,0x20,0x35,0xB2,0x2B,0xFB,0xC4,0x69,0xDB,0x88,0x14,0x2D,0xDB
        ,0x06,0xAD,0x91,0x24,0xC1,0xF8,0x3E,0x3A,0x4D,0x31,0x85,0x02,0x2A,0x9F,0x47
        ,0x3A,0x1D,0x6A,0xBB,0xCF,0xF1,0x7E,0xFB,0x14,0x47,0x2B,0x15,0x5E,0x1E,0x19
        ,0xE1,0xC2,0xF2,0x32,0xF3,0xD7,0xFF,0x4C,0xEF,0x8B,0xBC,0xAD,0x95,0x52,0xAD
        ,0x34,0x8E,0xC1,0x98,0x47,0x14,0x63,0x20,0x49,0xFA,0x47,0x4C,0x12,0x24,0x4D
        ,0x99,0x1C,0xDC,0xC3,0x52,0x73,0x13,0x8C,0xA1,0x1E,0xF7,0x18,0xD7,0x7A,0x13
        ,0x40,0x03,0xDF,0x47,0xAD,0x96,0x90,0x24,0x48,0xAF,0x87,0x44,0x11,0xC4,0x31
        ,0xE6,0x61,0x0A,0x61,0x88,0xC4,0x31,0xA7,0x9E,0xAC,0x72,0xC5,0x75,0xF9,0xF2
        ,0xE9,0x09,0xBE,0x6D,0x79,0x32,0x93,0xA6,0x5F,0x00,0xE8,0x54,0xE4,0x23,0x7F
        ,0x7D,0x3D,0x34,0x61,0x88,0x44,0x11,0x12,0x86,0x98,0x76,0x1B,0x09,0x02,0x4C
        ,0x10,0xF4,0x63,0x0C,0x02,0x0A,0x71,0xCC,0x58,0xC6,0xC1,0xAC,0xDC,0x42,0x6D
        ,0x3E,0x90,0x51,0xF8,0x10,0x40,0x4F,0xC1,0x77,0x22,0xF2,0xC3,0xFD,0x7A,0x3D
        ,0x92,0x4E,0xA7,0x9F,0xB9,0xEF,0x63,0x3C,0x0F,0x69,0xB5,0xFA,0xD5,0xF7,0x59
        ,0x76,0x5D,0x9C,0xBD,0x7B,0x99,0x7E,0xE9,0x05,0x39,0x32,0x35,0xB5,0x76,0x0C
        ,0x0E,0x3D,0xB4,0x40,0x92,0xA6,0xAF,0x75,0x9A,0xCD,0x7B,0xEE,0xE2,0x62,0x37
        ,0x69,0x36,0x91,0xED,0x62,0xCF,0xC3,0x78,0x1E,0x9F,0xFC,0x75,0x9D,0x43,0x47
        ,0x8E,0xCA,0xDF,0xDA,0x51,0xFB,0x8E,0x1D,0xCF,0x14,0x8B,0xC5,0x77,0x01,0x6C
        ,0x80,0x29,0x78,0xF0,0x8B,0x48,0xAD,0xEB,0xFB,0x0B,0xAB,0x57,0xAF,0x4E,0x17
        ,0xCA,0x65,0xC9,0x96,0x4A,0x19,0xCB,0x71,0x48,0xE3,0x18,0xAF,0x69,0xBA,0xCD
        ,0xA0,0x96,0x69,0x2C,0xED,0x51,0x2A,0x32,0xAC,0xAE,0xE6,0x07,0x76,0x87,0xD3
        ,0xCE,0x1B,0x7C,0x3D,0xA8,0xFE,0xFD,0x54,0x3F,0xC3,0xA4,0x82,0x93,0x5A,0xEB
        ,0xE7,0x0D,0x94,0x95,0x52,0xEE,0x57,0xF2,0xC7,0xC0,0x73,0xEF,0x1C,0xA8,0xDA
        ,0x99,0xAD,0xB9,0x38,0x84,0xF3,0xEF,0x71,0x4B,0xF1,0x3F,0x30,0x8B,0xCC,0xD9
        ,0x79,0xDE,0xD2,0xD6,0x56,0xCF,0x24,0xD0,0x8B,0x38,0xFF,0x0F,0x1C,0xAE,0x98
        ,0x9F,0xE4,0x9C,0x3F,0x9D,0x00,0x00,0x00,0x00,0x49,0x45,0x4E,0x44,0xAE,0x42
        ,0x60,0x82
};

static const quint8 breakpoint_disabled_png[] =
    {
        0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A,0x00,0x00,0x00,0x0D,0x49,0x48,0x44
        ,0x52,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x08,0x06,0x00,0x00,0x00,0x1F
        ,0xF3,0xFF,0x61,0x00,0x00,0x00,0x01,0x73,0x52,0x47,0x42,0x00,0xAE,0xCE,0x1C
        ,0xE9,0x00,0x00,0x00,0x06,0x62,0x4B,0x47,0x44,0x00,0xFF,0x00,0xFF,0x00,0xFF
        ,0xA0,0xBD,0xA7,0x93,0x00,0x00,0x00,0x09,0x70,0x48,0x59,0x73,0x00,0x00,0x0D
        ,0xD7,0x00,0x00,0x0D,0xD7,0x01,0x42,0x28,0x9B,0x78,0x00,0x00,0x00,0x07,0x74
        ,0x49,0x4D,0x45,0x07,0xDA,0x03,0x05,0x0C,0x02,0x27,0x91,0x29,0x31,0x86,0x00
        ,0x00,0x02,0x65,0x49,0x44,0x41,0x54,0x38,0xCB,0x6D,0x93,0x3F,0x48,0x5B,0x51
        ,0x14,0xC6,0x7F,0xEF,0x4F,0x34,0x7F,0x1C,0x54,0x88,0xD8,0xD8,0x4A,0x30,0x25
        ,0xA4,0x53,0x45,0x02,0xDA,0x4E,0x3A,0x75,0x72,0x11,0xA9,0x85,0x82,0x73,0x07
        ,0xA1,0x9B,0x50,0xBA,0x6B,0xC5,0xA9,0x4B,0x33,0x3B,0x74,0x10,0xC4,0x45,0x28
        ,0x74,0xEA,0xA0,0x8D,0x0D,0x68,0xDB,0x2C,0xA6,0x0D,0x01,0x6D,0x9A,0x44,0x4C
        ,0xAA,0xC6,0x68,0x92,0x97,0xE4,0xBD,0x77,0x3B,0xE4,0xDA,0x3E,0xDB,0x5C,0xF8
        ,0xB8,0xDC,0x73,0xEF,0x77,0xCE,0xF9,0xCE,0x3D,0x47,0xA1,0xC3,0xDA,0x03,0x57
        ,0x13,0x1E,0x6A,0x10,0x04,0xB0,0xE0,0xA8,0x01,0x1F,0xA7,0xC0,0xFC,0xF7,0xAD
        ,0xE2,0x3C,0x7C,0x80,0x1E,0xAF,0xAE,0xBF,0xE8,0x9B,0x9D,0x7D,0xDE,0x3F,0x33
        ,0xA3,0x79,0xEF,0xDD,0xB3,0x00,0x6A,0xA9,0x94,0x76,0xB6,0xB9,0x69,0x9D,0x6F
        ,0x6C,0xBC,0x76,0x9B,0xE6,0xD2,0x7D,0xA8,0xFE,0x17,0x35,0x0E,0x43,0xC9,0x48
        ,0xE4,0xDB,0xE5,0xEE,0x6E,0xC5,0x6E,0x34,0xCA,0x42,0x88,0x53,0x27,0xEC,0x46
        ,0xA3,0x5C,0x89,0xC7,0x2B,0xC9,0x70,0xF8,0x20,0x0E,0x43,0x37,0xC8,0xEF,0xA0
        ,0xFB,0x4B,0x28,0x94,0xAC,0xA5,0x52,0x25,0x21,0xC4,0xA1,0x10,0x22,0x2B,0x84
        ,0xC8,0x09,0x21,0xF2,0x12,0x39,0x69,0x3B,0xAC,0xA5,0x52,0xA5,0xAF,0xA1,0xD0
        ,0xE7,0x3D,0x70,0x01,0xA8,0x00,0xFD,0xAA,0xBA,0x30,0xBC,0xB2,0x32,0xE0,0x89
        ,0x44,0x0A,0x80,0x01,0x34,0x69,0xEB,0xB5,0x25,0x4C,0x69,0x33,0x3C,0x91,0x48
        ,0xE1,0xF6,0xF2,0xF2,0x2D,0x4B,0x55,0x17,0x00,0x94,0x3D,0x70,0xB9,0xC7,0xC7
        ,0x4F,0xC2,0x5B,0x5B,0x87,0x2E,0xBF,0xDF,0x04,0x3C,0x80,0x1B,0xE8,0x02,0x74
        ,0x99,0xE4,0x1F,0x07,0x40,0xDD,0x2C,0x95,0xF4,0xEF,0xD3,0xD3,0xC1,0x83,0x44
        ,0x62,0x40,0xB5,0x60,0xC2,0x3B,0x36,0xA6,0xB9,0xFC,0xFE,0x13,0xA0,0xC1,0xDF
        ,0x4A,0xEB,0x40,0xB7,0x84,0xD3,0x51,0x43,0xF7,0xFB,0x4F,0xBC,0xA3,0xA3,0xAE
        ,0x3B,0x30,0xA1,0x0B,0xB8,0xDB,0x35,0x38,0x58,0xA6,0x5D,0xD9,0x6B,0x92,0x0D
        ,0x68,0x32,0x1B,0x1C,0x72,0x5A,0x32,0x8B,0x6A,0x57,0x20,0x50,0x56,0x20,0xAC
        ,0x03,0xD8,0x86,0x61,0x03,0x15,0x87,0x03,0x8F,0x24,0x89,0x0E,0x12,0xAA,0x40
        ,0x45,0xB4,0x39,0xE8,0x0A,0x64,0x8C,0x74,0xBA,0x0F,0xDB,0x2E,0xA3,0xAA,0x9A
        ,0x8C,0xAC,0xCB,0x02,0x5F,0xCB,0xA9,0x02,0x97,0xC0,0x05,0x70,0x81,0x6D,0x97
        ,0xEB,0xE9,0x74,0xAF,0x80,0xB4,0x5A,0x83,0x5D,0x23,0x93,0xB1,0x2B,0x3B,0x3B
        ,0xDD,0x40,0x09,0xF8,0x25,0xF7,0x22,0x70,0x2C,0x51,0x74,0xDE,0x55,0xB6,0xB7
        ,0xDD,0x46,0x3A,0x6D,0xFD,0x84,0x4F,0xEA,0x14,0x98,0xAD,0x5C,0xEE,0x55,0x31
        ,0x16,0x9B,0xC4,0x34,0x8F,0x81,0x02,0x90,0x03,0xB2,0xC0,0x0F,0x89,0xAC,0xB4
        ,0x15,0x30,0xCD,0xE3,0x62,0x2C,0x36,0x69,0xE4,0xF3,0x4B,0x8F,0xC1,0x52,0xAE
        ,0x7B,0x5F,0x0B,0x06,0x13,0x3D,0xD1,0xE8,0xF9,0xC8,0xDA,0xDA,0xBA,0xEA,0xF5
        ,0xF6,0x00,0x3E,0xF9,0x95,0x48,0xFD,0x55,0xBB,0x56,0xBB,0xCA,0xCC,0xCF,0x3F
        ,0xA9,0xED,0xEF,0xF7,0x5A,0x47,0x47,0xE3,0x51,0x68,0x29,0xCE,0x56,0x76,0x07
        ,0x02,0xEF,0x5D,0x7E,0xBF,0xD2,0x37,0x37,0xF7,0x76,0x68,0x71,0x31,0x83,0xA6
        ,0xB5,0xBF,0xAF,0xD9,0xB4,0xF2,0xAB,0xAB,0xA1,0xB3,0xF5,0xF5,0xA7,0xE6,0xE9
        ,0xA9,0x65,0x17,0x0A,0x8F,0xA2,0x6D,0x69,0x37,0x87,0x29,0x09,0xBE,0x96,0xCF
        ,0xF7,0x12,0x5D,0x7F,0x86,0xA6,0x59,0xAA,0xC7,0x93,0x05,0xB0,0xEB,0xF5,0x61
        ,0x2C,0x4B,0x13,0x96,0xF5,0x46,0xB9,0xBA,0x5A,0x8A,0x42,0xAD,0xE3,0x34,0x3A
        ,0xA6,0x52,0xF7,0xC2,0x03,0x60,0x84,0x76,0x03,0x64,0x0C,0x48,0x74,0x1A,0xE7
        ,0xDF,0xC8,0x8D,0x30,0x4C,0x9E,0x93,0x90,0x83,0x00,0x00,0x00,0x00,0x49,0x45
        ,0x4E,0x44,0xAE,0x42,0x60,0x82
};

class QsciLexerTextParser: public QsciLexerCustom
{
public:
    QsciLexerTextParser(const textparser_language_definition *definition)
        : m_definition(definition)
    {
        if (m_definition)
        {
            for(int c = 0;;c++)
            {
                if (m_definition->tokens[c].name == nullptr)
                {
                    m_tokenCnt = c;
                    break;
                }

                if (m_definition->tokens[c].text_color != -1)
                    setColor(QColor::fromRgb(m_definition->tokens[c].text_color >> 16 & 0xff, m_definition->tokens[c].text_color >> 8 & 0xff, m_definition->tokens[c].text_color >> 0 & 0xff), c + 1);
                if (m_definition->tokens[c].text_background != -1)
                    setColor(QColor::fromRgb(m_definition->tokens[c].text_background >> 16 & 0xff, m_definition->tokens[c].text_background >> 8 & 0xff, m_definition->tokens[c].text_background >> 0 & 0xff), c + 1);
            }
        }
    }

    const char *language() const override
    {
        if (m_definition == nullptr)
            return "{not set}";

        return m_definition->name;
    }

    QString description(int style) const override
    {
        QString ret;

        if (style < m_tokenCnt)
            ret = m_definition->tokens[style].name;

        return ret;
    }

    void recursivelyStyleText(const textparser_token_item *token)
    {
        if (token == nullptr)
            return;

        startStyling(token->position);
        setStyling(token->len, token->token_id + 1);

        if (token->child)
        {
            recursivelyStyleText(token->child);
        }

        if (token->next)
        {
            recursivelyStyleText(token->next);
        }
    }

    void styleText(int start, int end) override
    {
        auto text = editor()->text().toLatin1();
        if (text.length() <= 0)
            return;

        textparser_defer(parser);
        textparser_openmem(text.constData(), text.length(), TEXTPARSER_ENCODING_LATIN1, &parser);

        if (textparser_parse(parser, m_definition) != 0)
            return;

        startStyling(0);
        setStyling(text.length(), 0);

        const textparser_token_item *token = textparser_get_first_token(parser);

        recursivelyStyleText(token);
    }

private:
    const textparser_language_definition *m_definition = nullptr;
    int m_tokenCnt = 0;
};

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
{
    ui->setupUi(this);

    ui->textEdit->setLexer(new QsciLexerTextParser(&cfml_definition));

    // Show line numbers
    ui->textEdit->setMarginType(0, QsciScintilla::SymbolMarginDefaultBackgroundColor);
    ui->textEdit->setMarginType(1, QsciScintilla::NumberMargin);

    ui->textEdit->setMarginSensitivity(0, true);
    ui->textEdit->setMarginLineNumbers(1, true);

    updatePanelWidth();

    m_breakpointMarker = ui->textEdit->markerDefine(QPixmap::fromImage(QImage::fromData(breakpoint_png, sizeof(breakpoint_png))));
    m_breakpointPendingMarker = ui->textEdit->markerDefine(QPixmap::fromImage(QImage::fromData(breakpoint_pending_png, sizeof(breakpoint_pending_png))));
    m_breakpointDisabledMarker = ui->textEdit->markerDefine(QPixmap::fromImage(QImage::fromData(breakpoint_disabled_png, sizeof(breakpoint_disabled_png))));

    ui->textEdit->setMarginMarkerMask(0, 1);
    ui->textEdit->setMarginMarkerMask(1, 0);
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::on_textEdit_marginClicked(int margin, int line, const Qt::KeyboardModifiers &state)
{
    if (margin == 0)
    {
        if (ui->textEdit->markersAtLine(line))
            ui->textEdit->markerDelete(line);
        else
            ui->textEdit->markerAdd(line, m_breakpointMarker);
    }
}

void MainWindow::on_textEdit_SCN_ZOOM()
{
    updatePanelWidth();
}

void MainWindow::on_textEdit_linesChanged()
{
    updatePanelWidth();
}

void MainWindow::updatePanelWidth()
{
    int lineHeight = ui->textEdit->SendScintilla(QsciScintilla::SCI_TEXTHEIGHT, 0);
    ui->textEdit->setMarginWidth(0, lineHeight + 4);

    int lines = ui->textEdit->lines();
    if (lines < 999)
        lines = 999;

    QString linesStr = QString::number(lines);

    ui->textEdit->setMarginWidth(1, linesStr);
}
